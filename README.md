# trait_ctp

## info
CTMM-TraIT CTP repository to:
- store collection and site specific CTP configurations
- store the supported CTP client version
- generate a standard CTP configurationfor a new collection and site (scripted)

## requirements
to run CTP and the generation scripts the following libraries are required
- java 8
- jq (to parse json, https://stedolan.github.io/jq/download/)
- dcmtk (to test the dicom transfer, https://dicom.offis.de/dcmtk.php.en)

## generation manual
follow these steps to generate a new configuration:
1. git pull (to get the latest repository changes)
2. edit the pipeline_config.json
    - name: this should be the exact same name as in XNAT (case-sensitve)
    - site: identifier or name for the contributing site
    - uid: the DICOM root UID generated by the trait servicedesk 
    - webport: 8080 default
    - dicomport: 104 default
3. run "sh generate_pipeline.sh" (the configuration will show up in ../site_configurations)
4. run "sh start_ctp.sh" (this will start the generated configuration)
    - this script will also add a lookup.properties so the test data will not go to quarantine, the patient id will be "_trait_admin_test"
5. open a new terminal, run "sh send_test_files.sh"
    - login to xnat, the prearchive should have a new study with 10 CT-slices for patient "_trait_admin_test"
6. if the configuration is correct:
    - run "sh clean_ctp.sh", this is the same script will clean the ./scr/CTP folder
    - add the ./src/"CTP_[COLLECTION_NAME] [SITE_NAME].zip" to topdesk for redistribution
    - git commit/push

## building custimized pipelines
if the standard pipeline does not fulfill the requirements for a collection/site use these steps to create custom pipelines:
* go to /site_configurations/[COLLECTION_NAME]/[SITE_NAME] and alter the config.xml or the anonymizer.properties
* make sure the pipeline_config.json matches the settings of the pipeline you want to test
* after changes redo step 4.to 6.